define(["jquery","core/ajax","core/notification","core/str","core/templates","core/url","core/modal_events","core/modal_factory","block_enrolcode/modal_code","block_enrolcode/modal_enter"],function(a,b,c,d,e,f,g,h,i,j){return{getCode:function(d){console.log("MAIN.getCode(uniqid)",d);var f=a("#courseid-"+d).val(),g=a("#roleid-"+d).val();b.call([{methodname:"block_enrolcode_get",args:{courseid:f,roleid:g},done:function(b){""!=b&&null!=b?(console.log("Got code",b),h.create({type:i.TYPE}).then(function(c){var d=c.getRoot();a(d).find("#code").html(b),c.show()})):h.create({type:h.types.OK,title:"Error",body:e.render("block_enrolcode/code_get_error",{})}).then(function(a){a.show()})},fail:c.exception}])},getCodeModal:function(a){b.call([{methodname:"block_enrolcode_form",args:{courseid:a},done:function(a){d.get_strings([{key:"code:get",component:"block_enrolcode"}]).done(function(b){h.create({type:h.types.OK,title:b[0],body:a}).then(function(a){var b=a.getRoot();b.on(g.OK,function(){console.log("Hiding modal"),a.hide()}),a.show()})}).fail(c.exception)},fail:c.exception}])},revokeCode:function(a){console.log("MAIN.revokeCode(code)",a),b.call([{methodname:"block_enrolcode_revoke",args:{code:a},done:function(a){},fail:c.exception}])},sendCode:function(d,e){console.log("MAIN.sendCode(uniqid, code)",d,e),"undefined"!=typeof d&&""!=d&&(e=a("#code-"+d).val()),b.call([{methodname:"block_enrolcode_send",args:{code:e},done:function(a){console.log("Got courseid ",a),a>1?top.location.href=f.relativeUrl("/course/view.php?id="+a,{}):h.create({type:h.types.OK,title:"Error",body:"Invalid code"}).then(function(a){a.show()})},fail:c.exception}])},sendCodeModal:function(){h.create({type:j.TYPE}).then(function(a){a.show()})}}});